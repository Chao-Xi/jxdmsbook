
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jacob's 分布式系统技术与实战教程">
      
      
        <meta name="author" content="Jacob Xi">
      
      
        <link rel="canonical" href="https://chao-xi.github.io/jxdmsbook/dapr/6dapr_sec/">
      
      
        <link rel="prev" href="../5dapr_mon/">
      
      
        <link rel="next" href="../7dapr_middle/">
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>6 Dapr 入门教程之密钥存储 - Jacob Distributed Message System Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#6-dapr" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jacob Distributed Message System Book" class="md-header__button md-logo" aria-label="Jacob Distributed Message System Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jacob Distributed Message System Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6 Dapr 入门教程之密钥存储
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chao-Xi/jxdmsbook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxdmsbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jacob Distributed Message System Book" class="md-nav__button md-logo" aria-label="Jacob Distributed Message System Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Jacob Distributed Message System Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chao-Xi/jxdmsbook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxdmsbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kafka 快速入门2023
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kafka 快速入门2023
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka2_intro/1intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 初识 Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka2_intro/2install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Kafka 安装和重要配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka2_intro/3producer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Kafka Producer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka2_intro/4consumer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Kafka Consumer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kafka 核心技术
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Kafka 核心技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka1/1kafka_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap1 Kafka 入门
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka1/2kafa_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap2 kafka基本部署参数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka1/3kafa_client1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    chap3 客户端实践及原理1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka1/4kafka_client2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    chap4 客户端实践及原理2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka1/5kafka_core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap5 Kafka 内核
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ka1/6kafka_mgt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap6 Kafka 管理&工具脚本
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kafka 技术详解
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Kafka 技术详解
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/1chap1_kafka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Kafka设计介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/2chap1_terminology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 Kafka中的关键术语解释
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/3chap1_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 Kafka的工作原理和过程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/4chap1_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 Kafka 集群搭建
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/5chap1_API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 Kafka API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/6chap1_chater/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 图解 Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/7chap1_kafka_ha/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第七节 Kafka 宕机引发的高可用问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/8chap1_kafka_int1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第八节 面试必问的 kafka 知识点
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/9chap1_kafka_int2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第九节 Kafka经典面试题详解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/10kafka_rabbitmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十节 RabbitMQ和Kafka的比较
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1kafka/11chap1_kafka_5min/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十一节 5 分钟搞懂高性能分布式消息系统 Kafka
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kafka K8S&Opt
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Kafka K8S&Opt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2kafka/1kafka_k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L1 在 Kubernetes 上运行高可用的 Kafka 集群
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2kafka/2kafa_opt1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L2 Kafka实战—常见运维操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2kafka/3kafka_opt2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L3 kafka应用经验
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2kafka/4operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L4 Kafka Operator 实践和解析
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    分布式链路追踪
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            分布式链路追踪
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3track_mon/1data_mon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 数据观测：数据追踪的基石
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3track_mon/2log_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 系统稳定性的关键系统日志&编写可观测的日志
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Serverless 技术
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Serverless 技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4serverless/1Serverless_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L1 Serverless 价值与机构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4serverless/2functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L2 Serverless 函数的简介
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    dapr Distributed Application Runtime
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            dapr Distributed Application Runtime
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1dapr_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Dapr 入门教程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2dapr_pub_sub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Dapr 入门教程之发布订阅
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3dapr_msg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Dapr 入门教程之消息队列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4dapr_tracing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Dapr 可观测性之分布式追踪
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5dapr_mon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Dapr 可观测性之指标与日志
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    6 Dapr 入门教程之密钥存储
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    6 Dapr 入门教程之密钥存储
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    <span class="md-ellipsis">
      本地环境使用 Secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes 环境使用 Secrets
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7dapr_middle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Dapr 入门教程之中间件
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    <span class="md-ellipsis">
      本地环境使用 Secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes 环境使用 Secrets
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="6-dapr"><strong>6 Dapr 入门教程之密钥存储</strong></h1>
<p><strong>应用程序通常通过使用专用的 Secret 存储来存储敏感信息，如密钥和 Token，用于与数据库、服务和外部系统进行身份验证的 Secret 等</strong>。</p>
<p>通常这需要涉及到设置一个 Secret 存储，如 Azure Key Vault、Hashicorp Vault 等，并在那里存储应用程序级别的私密数据。</p>
<p>为了访问这些 Secret 存储，应用程序需要导入 Secret 存储的 SDK，并使用它来访问私密数据，这可能需要相当数量的代码，这些代码与应用程序的实际业务领域无关，因此在可能使用不同供应商特定的 Secret 存储的多云场景中，这将成为更大的挑战。</p>
<p>为了使开发者更容易使用应用程序的私密数据，Dapr 有一个专门的 Secret 构建块 API，允许开发者从 Secret 存储中获取私密数据。使用 Dapr 的 Secret 存储构建块通常涉及以下内容。</p>
<ul>
<li>为特定的 Secret 存储解决方案设置一个组件。</li>
<li>在应用程序代码中使用 Dapr 的 Secret API 来检索私密数据。</li>
<li>(可选)在 Dapr 组件文件中引用 Secret。</li>
</ul>
<p>默认情况下，Dapr 在 Kubernetes 模式下通过 Helm 或 <code>dapr init -k</code> 部署的时候，启用一个内置的 Kubernetes Secret 存储，如果你使用另一个 Secret 存储，你可以使用 <code>disable-builtin-k8s-secret-store</code> 设置禁用 <code>Dapr Kubernetes Secret</code> 存储。</p>
<p>应用程序代码可以调用 Secret 构建块 API 从 Dapr 支持的 Secret 存储中检索私密数据，这些 Secret 存储可以在你的代码中使用。</p>
<p>例如，下图显示了一个应用程序从配置的云 Secret 存储库中的一个名为 vault 的 Secret 存储库中请求名为 mysecret 的私密数据。</p>
<p><img alt="Alt Image Text" src="../../images/dapr1_6_1.jpeg" title="Body image" /></p>
<p>应用程序可以使用 secrets API 来访问来自 Kubernetes Secret 存储的私密数据。在下面的例子中，应用程序从 Kubernetes Secret 存储中检索相同的 mysecret。</p>
<p><img alt="Alt Image Text" src="../../images/dapr1_6_2.jpeg" title="Body image" /></p>
<h2 id="secrets"><strong>本地环境使用 Secrets</strong></h2>
<p>同样我们以 quickstarts 仓库进行说明。</p>
<pre><code>git clone [-b &lt;dapr_version_tag&gt;] https://github.com/dapr/quickstarts.git
cd quickstarts
</code></pre>
<p>然后定位到 secretstore 目录下面的 node 文件夹：</p>
<pre><code>$ cd tutorials/secretstore/node
</code></pre>
<p>在 app.js 中是一个简单的 Express 应用，它暴露了一些路由和处理程序，我们可以先查看下该文件中的如下内容：</p>
<pre><code>const daprPort = process.env.DAPR_HTTP_PORT || 3500;
const secretStoreName = process.env.SECRET_STORE;
const secretName = &quot;mysecret&quot;;
</code></pre>
<p>其中 secretStoreName 从环境变量 <code>SECRET_STORE</code> 中读取，其为 Kubernetes 部署注入了值 kubernetes，对于本地开发，环境变量必须设置为 localsecretstore 值。</p>
<p>然后我们看看 getsecret 处理程序代码：</p>
<pre><code>app.get(&quot;/getsecret&quot;, (_req, res) =&gt; {
  const url = `${secretsUrl}/${secretStoreName}/${secretName}?metadata.namespace=default`;
  console.log(&quot;Fetching URL: %s&quot;, url);
  fetch(url)
    .then((res) =&gt; res.json())
    .then((json) =&gt; {
      let secretBuffer = new Buffer(json[&quot;mysecret&quot;]);
      let encodedSecret = secretBuffer.toString(&quot;base64&quot;);
      console.log(&quot;Base64 encoded secret is: %s&quot;, encodedSecret);
      return res.send(encodedSecret);
    });
});
</code></pre>
<p>该代码从 secret store 中获取名为 mysecret 的数据，并显示该数据的 Base64 编码数据。</p>
<p>我们在 secrets.json 文件中添加一个 mysecret 的 Secret 数据：</p>
<pre><code>{
  &quot;mysecret&quot;: &quot;abcd&quot;
}
</code></pre>
<p>同样我们也需要添加一个 Secret 对应的 Component 组件，比如在本地自拓管模式，创建一个如下所示的配置文件：</p>
<pre><code>apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: localsecretstore
  namespace: default
spec:
  type: secretstores.local.file
  version: v1
  metadata:
    - name: secretsFile
      value: secrets.json
    - name: nestedSeparator
      value: &quot;:&quot;
</code></pre>
<p>上面的组件定义了一个本地 Secret 存储库，其 Secret 文件路径为 secrets.json 文件。</p>
<blockquote>
<p><strong>其中 Secret 存储 JSON 的路径是与你调用 dapr run 的位置相关的。</strong></p>
</blockquote>
<p>然后我们需要将上面的 Secret Store 名称设置为环境变量：</p>
<pre><code># nux/Mac OS:
export SECRET_STORE=&quot;localsecretstore&quot;

# Windows:
set SECRET_STORE=localsecretstore
</code></pre>
<p>接下来我们为 Node 应用安装依赖：</p>
<pre><code>npm install # yarn
</code></pre>
<p>然后我们使用 Dapr 带上本地的 secret store 组件运行 Node 应用：</p>
<pre><code>$ dapr run --app-id nodeapp --components-path ./components --app-port 3000 --dapr-http-port 3500 node app.js
ℹ️  Starting Dapr with id nodeapp. HTTP Port: 3500. gRPC Port: 58744
INFO[0000] starting Dapr Runtime -- version 1.8.4 -- commit 18575823c74318c811d6cd6f57ffac76d5debe93  app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
# ......
INFO[0000] component loaded. name: localsecretstore, type: secretstores.local.file/v1  app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
INFO[0000] all outstanding components processed          app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
# ......
== APP == Node App listening on port 3000!
INFO[0000] application discovered on port 3000           app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
WARN[0000] [DEPRECATION NOTICE] Adding a default content type to incoming service invocation requests is deprecated and will be removed in the future. See https://docs.dapr.io/operations/support/support-preview-features/ for more details. You can opt into the new behavior today by setting the configuration option `ServiceInvocation.NoDefaultContentType` to true.  app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
INFO[0000] application configuration loaded              app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
INFO[0000] actors: state store is not configured - this is okay for clients but services with hosted actors will fail to initialize!  app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
INFO[0000] actor runtime started. actor idle timeout: 1h0m0s. actor scan interval: 30s  app_id=nodeapp instance=MBP2022.local scope=dapr.runtime.actor type=log ver=1.8.4
INFO[0000] dapr initialized. Status: Running. Init Elapsed 326.57000000000005ms  app_id=nodeapp instance=MBP2022.local scope=dapr.runtime type=log ver=1.8.4
INFO[0000] placement tables updated, version: 0          app_id=nodeapp instance=MBP2022.local scope=dapr.runtime.actor.internal.placement type=log ver=1.8.4
ℹ️  Updating metadata for app command: node app.js
✅  You're up and running! Both Dapr and your app logs will appear here.
</code></pre>
<p>启动后我们可以使用 dapr list 来查看应用列表：</p>
<pre><code>$ dapr list
  APP ID   HTTP PORT  GRPC PORT  APP PORT  COMMAND      AGE  CREATED              PID
  nodeapp  3500       58744      3000      node app.js  11m  2022-09-27 15:13.46  5906
</code></pre>
<p>启动完成后我们可以直接访问应用的 getsecret 接口：</p>
<pre><code>$ curl -k http://localhost:3000/getsecret
</code></pre>
<p>正常输出结果是 <code>YWJjZA==</code>，也就是上面的 abcd 做了 base64 编码后的值。</p>
<p>然后观察应用的日志会出现类似于如下所示的内容</p>
<pre><code>== APP == Fetching URL: http://localhost:3500/v1.0/secrets/localsecretstore/mysecret?metadata.namespace=default

== APP == Base64 encoded secret is: YWJjZA==
</code></pre>
<p>测试完成后可以使用 dapr stop 命令来停止应用：</p>
<pre><code>dapr stop --app-id nodeapp
</code></pre>
<h2 id="kubernetes-secrets">Kubernetes 环境使用 Secrets</h2>
<p>接下来我们来了解下在 Kubernetes 模式下 Dapr 是如何使用 Secrets store 的，当然首先需要在 Kubernetes 集群中安装 Dapr 控制平面。</p>
<p>Dapr 可以使用许多不同的 secret stores 来解析 secrets 数据，比如 AWS Secret Manager、 Azure Key Vault、 GCP Secret Manager、 Kubernetes 等，我们这里可以直接使用 Kubernetes 的 Secret 对象进行演示</p>
<p>首先讲 secrets 数据添加到 <code>./mysecret</code>文件，比如你的密码是 abcd，则 <code>./mysecret</code> 文件内容应该就是 abcd。</p>
<p>然后基于 <code>./mysecret</code> 文件创建一个 Kubernetes Secret 对象：</p>
<pre><code>$ kubectl create secret generic mysecret --from-file ./mysecret
</code></pre>
<p>注意创建的 Secret 对象的名称 mysecret，后面会使用到。</p>
<p>创建完成后我们可以查看下该对象中的数据是否符合预期：</p>
<pre><code>$ kubectl get secret mysecret -o yaml
apiVersion: v1
data:
  mysecret: YWJjZAo=
kind: Secret
metadata:
  creationTimestamp: &quot;2022-09-27T07:34:31Z&quot;
  name: mysecret
  namespace: default
  resourceVersion: &quot;5133821&quot;
  uid: c9aa573c-5f71-439c-b482-748ac0fe3ae7
type: Opaque
</code></pre>
<p>接下来我们就可以部署 Node.js 应用到 Kubernetes 集群中，对应的资源清单文件如下所示：</p>
<pre><code>kind: Service
apiVersion: v1
metadata:
  name: nodeapp
  labels:
    app: node
spec:
  selector:
    app: node
  ports:
    - protocol: TCP
      port: 80
      targetPort: 3000
  type: LoadBalancer

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nodeapp
  labels:
    app: node
spec:
  selector:
    matchLabels:
      app: node
  template:
    metadata:
      labels:
        app: node
      annotations:
        dapr.io/enabled: &quot;true&quot;
        dapr.io/app-id: &quot;nodeapp&quot;
        dapr.io/app-port: &quot;3000&quot;
    spec:
      containers:
        - name: node
          image: ghcr.io/dapr/samples/secretstorenode:latest
          env:
            - name: SECRET_STORE
              value: &quot;kubernetes&quot;
          ports:
            - containerPort: 3000
          imagePullPolicy: Always
</code></pre>
<p>这里的核心重点是需要我们配置环境变量 <code>SECRET_STORE</code>，将其值设置为 kubernetes，这样我们的应用就知道应该通过 Kubernetes 获取 Secret 数据了。直接部署该应用即可：</p>
<pre><code>$ kubectl apply -f deploy/node.yaml
$ kubectl get pods
NAME                                    READY   STATUS    RESTARTS       AGE
nodeapp-6cb5b689cf-vtn74                2/2     Running   0              92
$ kubectl get svc
NAME                        TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)                               AGE
nodeapp                     LoadBalancer   10.101.216.73    192.168.0.50   80:32719/TCP                          13d
nodeapp-dapr                ClusterIP      None             &lt;none&gt;         80/TCP,50001/TCP,50002/TCP,9090/TCP   13d
</code></pre>
<p>部署完成后我们这里可以通过 192.168.0.50 这个 EXTERNAL-IP 访问到应用：</p>
<pre><code>curl -k http://192.168.0.50/getsecret
</code></pre>
<p>正常上面的请求输出结果为 YWJjZAo=，也可以查看 Node 应用日志：</p>
<pre><code>$ kubectl logs --selector=app=node -c node
Node App listening on port 3000!
Fetching URL: http://localhost:3500/v1.0/secrets/kubernetes/mysecret?metadata.namespace=default
Base64 encoded secret is: YWJjZAo=
</code></pre>
<p>从上面日志可以看出 Node 应用程序正在向 dapr 发出请求，以便从 secret store 获取 secret 数据，注意其中的 mysecret 是上面创建的 Secret 对象名称。</p>
<p>当然如果你使用的是其他 secret store，比如 HashiCorp Vault 则需要创建一个对应的 Component 组件了，类型为 <code>secretstores.hashicorp.vault</code>，如下所示的资源清单：</p>
<pre><code>apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: vault
spec:
  type: secretstores.hashicorp.vault
  version: v1
  metadata:
  - name: vaultAddr
    value: [vault_address] # Optional. Default: &quot;https://127.0.0.1:8200&quot;
  - name: caCert # Optional. This or caPath or caPem
    value: &quot;[ca_cert]&quot;
  - name: caPath # Optional. This or CaCert or caPem
    value: &quot;[path_to_ca_cert_file]&quot;
  - name: caPem # Optional. This or CaCert or CaPath
    value : &quot;[encoded_ca_cert_pem]&quot;
  - name: skipVerify # Optional. Default: false
    value : &quot;[skip_tls_verification]&quot;
  - name: tlsServerName # Optional.
    value : &quot;[tls_config_server_name]&quot;
  - name: vaultTokenMountPath # Required if vaultToken not provided. Path to token file.
    value : &quot;[path_to_file_containing_token]&quot;
  - name: vaultToken # Required if vaultTokenMountPath not provided. Token value.
    value : &quot;[path_to_file_containing_token]&quot;
  - name: vaultKVPrefix # Optional. Default: &quot;dapr&quot;
    value : &quot;[vault_prefix]&quot;
  - name: vaultKVUsePrefix # Optional. default: &quot;true&quot;
    value: &quot;[true/false]&quot;
  - name: enginePath # Optional. default: &quot;secret&quot;
    value: &quot;secret&quot;
  - name: vaultValueType # Optional. default: &quot;map&quot;
    value: &quot;map&quot;
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-9999 Jacob Xi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>